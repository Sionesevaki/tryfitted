# Avatar Worker Environment Variables

# Redis configuration
REDIS_URL=redis://localhost:6379

# MinIO configuration
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=tryfitted
MINIO_SECURE=false

# API configuration
API_BASE_URL=http://localhost:3001

# Model paths
# For Docker images, these are typically under /app/models/*
# For running from source (recommended during dev), these defaults work when launched from `services/avatar-worker/`:
#   SMPLX_MODEL_DIR=models/smplx
#   PIXIE_MODEL_DIR=src/pipeline/PIXIE
SMPLX_MODEL_DIR=models/smplx
PIXIE_MODEL_DIR=src/pipeline/PIXIE

# Processing configuration
MAX_RETRIES=3
PROCESSING_TIMEOUT=300
REQUIRE_REAL_AVATAR=false
# If true, the worker fails the job if gltfpack isn't available (no silent fallback).
REQUIRE_GLTFPACK=true
PIXIE_USE_TEX=false
# Avatar pose for display (exported GLB). Measurements use a T-pose mesh for stability.
# - apose: arms slightly lowered from T-pose (recommended for try-on visuals)
# - tpose: arms straight out
# - pixie: pose predicted from the input photo (can cause arms to intersect torso)
AVATAR_DISPLAY_POSE=apose
# Only used when AVATAR_DISPLAY_POSE=apose
AVATAR_APOSE_ARM_DOWN_DEG=25
SMPL_ANTHRO_MODEL_EXT=pkl

# --- Fit accuracy refinement (Option A) ---
# Uses sam-3d-body to generate masks/keypoints, estimates silhouette targets (chest/waist/hip),
# then refines SMPL-X betas so measurements better match the silhouettes.
SAM3DBODY_ENABLED=false
# Either install sam-3d-body as a package, OR point at a cloned repo so `tools/*` imports work:
SAM3DBODY_REPO_DIR=
# Paths to local model assets (avoid runtime downloads; required for Docker deployments)
SAM3DBODY_CHECKPOINT_PATH=
SAM3DBODY_MHR_PATH=
SAM3DBODY_DETECTOR_PATH=
SAM3DBODY_SEGMENTOR_PATH=
SAM3DBODY_FOV_PATH=
SAM3DBODY_USE_MASK=true
SILHOUETTE_REFINE_ENABLED=true
# Erosion amount when estimating torso widths from masks (helps reduce arm influence)
SILHOUETTE_TORSO_ERODE_PX=8
# GLB optimization (gltfpack)
# If gltfpack is on your PATH, leave as `gltfpack`.
# If you downloaded a binary, point directly at it.
# Windows tip: prefer forward slashes to avoid .env escape issues:
#   GLTFPACK_PATH=C:/Users/you/tools/gltfpack.exe
# Or escape backslashes:
#   GLTFPACK_PATH=C:\\Users\\you\\tools\\gltfpack.exe
GLTFPACK_PATH=gltfpack

# --- Deployment helper: automatic model sync (optional) ---
# If you want to avoid manually copying large model weights into a RunPod volume,
# upload them once to a PRIVATE MinIO bucket (recommended: `tryfitted-models`) in this layout:
#   smplx/...
#   pixie/...
#   sam3d/...
#   sam2/checkpoints/...
#   tools/gltfpack (Linux binary, optional)
#
# Then enable sync on the worker. The worker will download missing files into `/app/models/<name>`
# (typically a mounted RunPod Network Volume) at startup.
MODEL_SYNC_ENABLED=false
MODEL_SYNC_MINIO_ENDPOINT=s3.tryfitted.com
MODEL_SYNC_MINIO_SECURE=true
MODEL_SYNC_MINIO_BUCKET=tryfitted-models
MODEL_SYNC_MINIO_ACCESS_KEY=
MODEL_SYNC_MINIO_SECRET_KEY=
# Optional prefix within the bucket (empty means bucket root)
MODEL_SYNC_PREFIX=
# Which folders to sync (comma-separated). Each syncs to /app/models/<name>.
# If you also sync `tools`, the entrypoint will install `/app/models/tools/gltfpack` to `/usr/local/bin/gltfpack`.
MODEL_SYNC_SOURCES=smplx,pixie,sam3d,sam2,tools
MODEL_SYNC_LOCAL_ROOT=/app/models
